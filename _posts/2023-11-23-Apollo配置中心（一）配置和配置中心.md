---
layout: post 
title: Apollo配置中心（一）配置和配置中心
description:
date: 2023-11-23 09:01:05 +0800 
image: /images/covers/apollo-cover.jpg
tags:
- 配置
- 配置中心
- Apollo
category: ['Apollo']
---

1. 目录
{:toc}

## 前言：关于博客的思考

我对Apollo的学习主要靠三个过程完成，培训视频、官方文档及示例代码。
在学习的过程中，我逐渐发现以培训视频和博客记录为主导的学习方式是一种快餐式的，不利于深度思考的学习方式。

这种方式虽然可以在短时间内完成大量知识的学习，但是学习者无法达到对内容的真正掌握。
而不同项目的文档学习难度不尽相同，主要取决于开发者撰写文档的水平和读者的阅读量。但这种学习方式可以增加读者的思考时间，也不失是一种好的学习方法。

此外，关于Apollo配置中心的博客是在工作之余完成的，所以大部分内容基本都摘自官方文档。
记录该博客的主要目的在于加深自己对微服务架构的印象和理解，至于细节的具体实现还是要以[官方文档](https://www.apolloconfig.com/#/zh/README)为准。

## 配置

应用程序在启动和运行时往往需要读取一些配置信息，配置基本上伴随着应用程序的整个生命周期。
比如数据库连接参数、启动参数等。

配置主要有以下几个特点：

1. 配置是**独立于程序的只读变量**：
  - 配置首先是独立于程序的，同一份程序在不同的配置下会有不同的行为；
  - 其次，配置对于程序是只读的，程序通过读取配置来改变自己的行为，但是程序不应该去改变配置。
2. 配置**伴随应用的整个生命周期**：
  - 配置贯穿于应用的整个生命周期，应用在启动时通过读取配置来初始化，在运行时根据配置调整行为。比如启动时需要读取服务的端口号、系统在运行过程中需要读取定时策略执行定时任务等。
3. 配置可以有多种加载方式：
  - 常见的有程序内部硬编码，配置文件，环境变量，启动参数，基于数据库等。
4. 配置需要治理：
  - 权限控制：由于配置能改变程序的行为，不正确的配置甚至能引起灾难，所以配置的修改必须有完善的权限控制；
  - 不同环境、集群配置管理：同一份程序在不同的环境（开发、测试、生产）、不同的集群（如不同的数据中心）经常需要有不同的配置，所以需要有完善的环境、集群配置管理。

## 配置中心

传统单体应用存在一些潜在的缺陷，如随着规模的扩大，部署效率降低，团队协作效率差，系统可靠性变差，维护困难，新功能上线周期长等。
所以迫切需要一种新的架构去解决这些问题，而微服务架构是当下的解法之一。

当系统从一个单体应用，被拆分成分布式系统上一个个服务节点后，配置文件也必须跟着迁移（分割），这样配置就分散了，不仅如此，分散还包含着冗余。

配置中心**将配置从应用中剥离出来，统一管理。**
解决了配置的动态变更，持久化、运维成本等问题。

应用自身既不需要去添加管理配置接口，也不需要自己去实现配置的持久化，更不需要引入“定时任务”以便降低运维成本。

**总的来说，配置中心是一种统一管理各种应用配置的基础服务组件。**

在系统架构中，配置中心是整个微服务基础架构体系中的一个组件，一个合格的配置中心需要满足：

- 配置项容易读取和修改；
- 添加新配置简单直接；
- 支持对配置修改的监视以把控风险；
- 可以查看配置修改的历史记录；
- 不同部署环境支持隔离。
