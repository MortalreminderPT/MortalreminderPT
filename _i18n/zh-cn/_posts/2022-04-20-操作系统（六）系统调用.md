---
layout: post 
title: 操作系统（六）系统调用 
description: 操作系统（Operating System，OS）是指控制和管理计算机系统软硬件资源，合理组织调度计算机工作和资源分配，提供给用户和其它软件方便的接口和环境。
date: 2022-04-20 18:35:40 +0800 
image: /images/covers/操作系统-cover1.png
tags:
- 操作系统
---

1. 目录
{:toc}

## 什么是系统调用？系统调用的作用
操作系统作为用户和计算机硬件之间的接口，需要向上提供一些简单易用的服务。主要包括命令接口和程序接口。其中程序接口由一组**系统调用**组成。

<img src='\images\posts\操作系统-系统调用的作用1.svg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:100%;" />

“系统调用”是操作系统提供给应用程序（程序员/编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，**应用程序可以通过系统调用来请求获得操作系统内核的服务**。

<img src='\images\posts\操作系统-系统调用的作用2.svg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:100%;" />

## 系统调用与库函数的区别

|普通应用程序|可直接进行系统调用，也可使用库函数。有的库函数涉及系统调用，有的不涉及。|
|------------|----|
|编程语言|向上提供库函数。有时会将系统调用封装成库函数，以隐藏系统调用的一些细节，使程序员编程更加方便。|
|操作系统|向上提供系统调用，使得上层程序能请求内核的服务。|
|裸机||

<img src='\images\posts\操作系统-系统调用和库函数1.svg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:100%;" />

不涉及系统调用的库函数：如“取绝对值”的函数；

涉及系统调用的库函数：如“创建一个新文件”的函数。

## 为什么系统调用是必须的？

生活场景：去学校打印店打印论文，你按下了WPS的“打印”选项，打印机开始工作。

你的论文打印到一半时，另一位同学按下了Word的“打印”按钮，开始打印他自己的论文。

如果两个进程可以随意地、并发地共享打印机资源，打印机设备交替地收到WPS和Word两个进程发来的打印请求，两篇论文的内容混杂在一起了...

解决方法：**由操作系统内核对共享资源进行统一管理**，并向上提供“系统调用”用户进程想要使用打印机这种共享资源，只能通过系统调用向操作系统内核发出请求。内核会对各个请求进行协调处理。

## 什么功能要用系统调用实现

应用程序通过系统调用请求操作系统的服务。
而系统中的各种共享资源都由操作系统内核统一掌管，因此**凡是与共享资源有关的操作(如存储分配、I/O操作、文件管理等），都必须通过系统调用的方式向操作系统内核提出服务请求**，由操作系统内核代为完成。
这样可以**保证系统的稳定性和安全性**，防止用户进行非法操作。

<img src='\images\posts\操作系统-系统调用的功能.svg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:100%;" />

## 系统调用的过程

### 陷入指令系统调用
1. 应用程序执行传参指令，**将传递的参数（参数1、参数2...）存放于CPU寄存器**，参数可以指明系统调用类型；
2. 应用程序执行**陷入指令**，引发一个内中断信号。该中断由陷入指令引发，因此转入相应中断处理程序，即系统调用的入口程序；
3. 处理器转变为内核态运行，执行**系统调用入口程序**，根据寄存器中的参数判断用户需要哪种系统调用服务；
4. 运行**系统调用所对应的处理程序**；
5. 完成系统调用，CPU转变为用户态。

即传递系统调用参数→执行陷入指令（用户态）→执行相应的内请求核程序处理系统调用（内核态）→返回应用程序。

<img src='\images\posts\操作系统-系统调用的过程1.svg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:80%;" />

注意：
1. **陷入指令**是在**用户态**执行的，执行陷入指令之后立即**引发一个内中断**，使CPU**进入内核态**；
2. **发出系统调用请求是在用户态**，而**对系统调用的相应处理在核心态**下进行。



