---
layout: post 
title: 操作系统（三十九）内存的基础知识
description: 内存（Memory）是计算机的重要部件，也称内存储器和主存储器，它用于暂时存放CPU中的运算数据，以及与硬盘等外部存储器交换的数据，是外存与CPU进行沟通的桥梁。
date: 2022-05-02 13:51:43 +0800 
image: /images/covers/操作系统-cover4.jpg
tags:
- 操作系统
---

1. 目录
{:toc}

## 什么是内存
内存可存放数据。程序执行前**需要先放到内存中才能被CPU处理**——缓和CPU与硬盘之间的速度矛盾。

在多道程序环境下，系统中会有多个程序并发执行，也就是说会有多个程序的数据需要同时放到内存中。
那么，如何区分各个程序的数据是放在什么地方的呢？

内存中有一个一个的“小房间”，每个小房间就是一个“**存储单元**”。

内存地址从0开始，**每个地址对应一个存储单元**。

如果计算机“**按字节编址**”，则**每个存储单元大小为1字节**，即1B，即8个二进制位。

如果字长为**16位的计算机“按字编址”**，则**每个存储单元大小为1个字**；每个字的大小为**16个二进制位**。

补充知识：

$2^{10} = 1K$

$2^{20} = 1M$

$2^{30} = 1G$

一台手机/电脑有4GB内存，是什么意思？

是指该内存中可以存放$4*2^{30}$个字节。

如果是按字节编址的话，也就是有$4*2^{30} = 2^{32}$个存储单元。

需要$2^{32}$个地址才能一一标识，
所以地址需要用32个二进制位来表示（$0 \sim 2^{32}-1$）。

### 内存管理的概念

计算机**不可能将所有用户进程**和系统所需要的全部程序和数据**放入主存**，因此操作系统必须**对内存空间进行合理的划分和有效的动态分配**。

**内存管理**的概念就是**操作系统对内存的划分和动态分配**。

### 内存管理功能

- **内存空间的分配与回收**：由操作系统完成**主存储器空间的分配和管理**；
- 地址转换：将**逻辑地址**转换成**相应的物理地址**；
- 内存空间的**扩充**：利用**虚拟存储技术**或自动覆盖技术，从**逻辑上扩充主存**；
- **存储保护**：保证**各道作业在各自的存储空间内运行**，互不干扰。

### 逻辑地址和物理地址
- 逻辑地址：程序经过编译、链接后生成的指令中指明的是逻辑地址（相对地址），即:相对于进程的起始地址而言的地址；

## 进程运行基本原理

将用户**源程序变为可在内存中执行的程序**，通常需要以下几个步骤：
- **编译**：由编译程序将用户源代码编译成若干目标模块；（把高级语言翻译成机器语言）
- **链接**：由链接程序将编译后形成的一组目标模块及所需的库函数连接在一起，形成一个完整的装入模块；（由目标模块生成装入模块，链接后形成完整的逻辑地址)
- **装入**：由装入程序将装入模块装入内存运行，装入后形成物理地址。

### 三种链接方式
程序的链接有以下三种方式：
- **静态链接**：在程序运行之前，先将各目标模块及它们所需的库函数连接成一个完整的可执行文件（装入模块)，之后不再拆开；
- **装入时动态链接**：将各目标模块装入内存时，边装入边链接的链接方式；
- **运行时动态链接**：在程序执行中需要该目标模块时，才对它进行链接。其优点是便于修改和更新，便于实现对目标模块的共享。

### 三种装入方式
内存的装入模块在装入内存时，有以下三种方式:
- **绝对装入**（单道程序阶段）：在编译时，如果知道程序将放到内存中的哪个位置，编译程序将产生绝对的物理地址的目标代码。
装入程序按照装入模块中的地址，将程序和数据装入内存。 
- **静态可重定位装入**（早期多道批处理系统）：**编译后的模块**需要连续装入内存，但是**在内存中的物理地址可与逻辑地址不同**，可以存在一定偏移。
比如逻辑地址是0-100，它可以在内存中存储在100-200的内存单元中，需要设定一个偏移量就是100。
静态重定位的特点是在一个作业装入内存时，**必须分配其要求的全部内存空间**，如果没有足够的内存，就不能装入该作业。
**同时也需要为其分配连续的存储空间**，不然通过偏移量是无法找到的。
现在就可以通过作业的**逻辑地址+偏移量**获得作业在内存中的绝对地址。 
- **动态运行时装入**（现代操作系统）：将**不同的模块**可以装入在**不同的内存地址**，**不同模块可以不连续**，但是**同一模块还是要连续存放**的。
同一模块需要**设定一个重定位寄存器**，**每个模块的重定位寄存器中的值**就是对应的**偏移量**。
装入程序会把模块装入内存，但是并**不会立即将装入模块的相对地址转换为绝对地址**，而是把这种地址转换**推迟到程序真正执行时才进行**。
**可以将程序分配到不连续的存储区**。
