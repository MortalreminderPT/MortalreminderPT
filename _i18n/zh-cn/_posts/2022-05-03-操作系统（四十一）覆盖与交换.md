---
layout: post 
title: 操作系统（四十一）覆盖与交换
description: 内存（Memory）是计算机的重要部件，也称内存储器和主存储器，它用于暂时存放CPU中的运算数据，以及与硬盘等外部存储器交换的数据，是外存与CPU进行沟通的桥梁。
date: 2022-05-03 15:35:13 +0800 
image: /images/covers/操作系统-cover4.jpg
tags:
- 操作系统
---

1. 目录
{:toc}

## 覆盖技术
早期的计算机内存很小，比如IBM推出的第一台PC机最大只支持1MB大小的内存。
因此经常会出现内存大小不够的情况。

后来人们引入了**覆盖技术**，用来**解决“程序大小超过物理内存总和”的问题**。

覆盖技术的思想：将**程序分为多个段**（多个模块）。常用的段常驻内存，不常用的段在需要时调入内存。

内存中分为**一个“固定区”**和**若干个“覆盖区”**：
- 需要常驻内存的段放在“固定区”中，调入后就不再调出；（除非运行结束）
- 不常用的段放在“覆盖区”，需要用到时调入内存，用不到时调出内存。

### 示例

如图为程序X的调用结构，以及采用覆盖技术时各个模块在内存中所处位置。

模块A被放入固定区，模块B和C被放入同一覆盖区0，而模块D、E、F被放入另一覆盖区1：

<img src='\images\posts\操作系统-内存覆盖.jpg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:50%;" />

内存覆盖技术按照自身逻辑结构，让那些不可能同时被访问的程序段共享同个覆盖区。

**必须由程序员声明覆盖结构**，操作系统完成自动覆盖。缺点：**对用户不透明**，增加了用户编程负担。
覆盖技术只用于早期的操作系统中，现在已成为历史。

## 交换技术
交换（对换）技术的设计思想：
内存空间紧张时，系统将内存中**某些进程暂时换出外存**，把外存中**某些已具备运行条件的进程换入内存**。（进程在内存与磁盘间动态调度，中级调度）

如下图，中级调度（内存调度），就是要决定将哪个处于挂起状态的进程重新调入内存。

<img src='\images\posts\操作系统-进程-七状态模型.jpg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:50%;" />

### 问题

- 应该在外存（磁盘）的什么位置保存被换出的进程？

具有对换功能的操作系统中，通常把磁盘空间分为**文件区**和**对换区**两部分。
**文件区主要用于存放文件**，主要**追求存储空间的利用率**，因此对文件区空间的管理**采用离散分配方式**；
**对换区空间**只占磁盘空间的**小部分**，**被换出的进程数据就存放在对换区**。
由于对换的速度直接影响到系统的整体速度，因此**对换区空间的管理主要追求换入换出速度，因此通常对换区采用连续分配方式**。
总之，**对换区的I/O速度比文件区的更快**。

- 什么时候应该交换？

交换通常在许多进程运行且内存吃紧时进行，而系统负荷降低就暂停。
例如。在发现许多进程运行时经常发生缺页，就说明内存紧张，此时可以换出一些进程；
如果缺页率明显下降，就可以暂停换出。

- 应该换出哪些进程？

可优先换出阻塞进程；可换出优先级低的进程；
为了防止优先级低的进程在被调入内存后很快又被换出，有的系统还会考虑进程在内存的驻留时间。
（注意：**PCB会常驻内存**，不会被换出外存）

## 覆盖与交换的区别
- 覆盖是在同一个程序或进程中的；
- 交换是在不同进程（或作业）之间的。
