---
layout: post 
title: 操作系统（七）操作系统体系结构 
description: 操作系统（Operating System，OS）是指控制和管理计算机系统软硬件资源，合理组织调度计算机工作和资源分配，提供给用户和其它软件方便的接口和环境。
date: 2022-04-20 19:29:07 +0800
image: /images/covers/操作系统-cover1.png
tags:
- 操作系统
---

1. 目录
{:toc}

## 操作系统的内核

操作系统内部的层次结构可以进一步划分，如下图所示：

<img src='\images\posts\操作系统-操作系统分层.svg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:100%;" />

- 非内核部分：Ubuntu、CentOS的开发团队，其主要工作是实现非内核功能，而内核都是用了Linux内核。
- 时钟中断：利用时钟中断实现计时功能；
- 原语：原语是一种特殊的程序，具有原子性。也就是说，这段程序的运行必须一气呵成，不可被“中断”。

操作系统内部可以划分为内核和非内核部分，**内核**是操作系统最基本、最核心的部分，实现操作系统内核功能的程序是内核程序。

其中，**时钟管理、中断处理和原语等**部分是**与硬件关联较紧密的模块**；而**管理模块**负责的管理工作更多的是**对数据结构的操作，不会直接涉及硬件**。

**操作系统内核**需要运行在**内核态**；

**操作系统的非内核功能**运行在**用户态**。
## 宏内核（大内核/单内核）和微内核

把所有功能都包含在内的体系结构叫做宏内核；

<img src='\images\posts\操作系统-宏内核体系结构.jpg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:50%;" />

内核当中只保留与硬件关联最紧密部分的体系结构叫微内核。

<img src='\images\posts\操作系统-微内核体系结构.jpg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:50%;" />

现在，应用程序想要请求操作系统的服务，这个服务的处理同时涉及到进程管理、存储管理、设备管理。

此时使用宏内核结构需要进行两次变态，而使用微内核结构需要进行六次变态。

**变态的过程是有成本的**，要消耗不少时间，**频繁地变态会降低系统性能**。

宏内核的特点

所有的系统功能都放在内核里（宏内核结构的OS通常也采用了"模块化"的设计思想）。

宏内核的优点

性能高，内核内部各种功能都可以直接相互调用。

宏内核的缺点

1. 内核庞大功能复杂，难以维护；
2. 内核中某个功能模块出错，就可能导致整个系统崩溃。

微内核的特点

只把中断、原语、进程通信等最核心的功能放入内核。进程管理、文件管理、设备管理等功能以用户进程的形式运行在用户态。

微内核的优点

1. 内核小功能少、易于维护，内核可靠性高；
2. 内核外的某个功能模块出错不会导致整个系统崩溃。

微内核的缺点

1. 性能低，需要频繁的切换用户态/核心态。用户态下的各功能模块不可以直接相互调用，只能通过内核的”消息传递“来间接通信；
2. 用户态下的各功能模块不可以直接相互调用，只能通过内核的”消息传递“来间接通信。

## 分层结构

分层结构的特点

<img src='\images\posts\操作系统-分层结构.jpg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:50%;" />

内核分多层，每层可单向调用更低一层提供的接口。

分层结构的优点

1. 便于调试和验证，自底向上逐层调试验证；
2. 易扩充和易维护，各层之间调用接口清晰固定。

分层结构的缺点

1. 仅可调用相邻低层，难以合理定义各层的边界；
2. 效率低，不可跨层调用，系统调用执行时间长。

## 模块化

模块化是将操作系统按功能划分为若干个具有一定独立性的模块。每个模块具有某方面的管理功能，并**规定好各模块间的接口**，使各模块之间能通过接口进行通信。
还可以进一步将各模块细分为若干个具有一定功能的子模块，同样也**规定好各子模块之间的接口**。
把这种设计方法称为**模块-接口法**，下图为由模块、子模块等组成的模块化操作系统结构：

<img src='\images\posts\操作系统-模块化.jpg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:50%;" />

模块化的特点

将内核划分为多个模块，各模块之间相互协作。

内核=主模块+可加载内核模块；

主模块︰只负责核心功能，如进程调度、内存管理；

可加载内核模块︰可以动态加载新模块到内核，而无需重新编译整个内核。

模块化的优点

1. 模块间逻辑清晰易于维护，确定模块间接口后即可多模块同时开发；
2. 支持动态加载新的内核模块（如：安装设备驱动程序、安装新的文件系统模块到内核），增强OS适应性；
3. 任何模块都可以直接调用其他模块，无需采用消息传递进行通信，效率高。

模块化的缺点

1. 模块间的接口定义未必合理、实用；
2. 模块间相互依赖，更难调试和验证。

## 外核

外核的特点

内核负责进程调度、进程通信等功能，外核负责为用户进程分配未经抽象的硬件资源，且由外核负责保证资源使用安全。

外核的优点

1. 外核可直接给用户进程分配”不虚拟、不抽象“的硬件资源，使用户进程可以更灵活地使用硬件资源；
2. 减少了虚拟硬件资源的”映射层“，提升效率。

外核的缺点

1. 降低了系统的一致性；
2. 使系统变得更复杂。
