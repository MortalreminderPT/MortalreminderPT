---
layout: post 
title: 操作系统（十七）调度的概念和层次
description: 进程（Process）是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位。
date: 2022-04-23 17:38:13 +0800 
image: /images/covers/操作系统-cover2.png
tags:
- 操作系统
---

1. 目录
{:toc}

## 调度的概念
背景：
在银行取款时，普通客户一般先到先服务，但VIP客户可以优先被服务；
假设有一群人需要使用厕所，他们可以用先排队先使用的方式，也可以经过讨论后时间短的人优先使用。

类似的，当有一堆任务要处理，但由于资源有限，这些事情没法同时处理。这就需要确定**某种规则**来**决定**处理这些任务的**顺序**，这就是“调度”研究的问题。

## 调度的三个层次


### 高级调度

作业的定义：一个具体的任务

用户向系统提交一个作业≈用户让操作系统启动一个程序（来处理一个具体的任务）

当用户向系统提交大量作业时，有时内存空间有限，有时无法将用户提交的作业全部放入内存，此时需要采用高级调度，即作业调度的方式，决定哪些程序该优先启动。

**高级调度（作业调度）**：按一定的原则从外存的作业后备队列中挑选一个作业调入内存，并创建进程。**每个作业只调入一次，调出一次**。作业调入时会建立PCB，调出时才撤销PCB。

### 低级调度

**低级调度（进程调度/处理机调度）**：按照某种策略从就绪队列中选取一个进程，将处理机分配给它。

进程调度是操作系统中**最基本的一种调度**，在一般的操作系统中都必须配置进程调度。进程调度的**频率很高**，一般几十毫秒一次。

### 中级调度

在内存不够时，可将某些进程的数据调出外存。等内存空闲或者进程需要运行时再重新调入内存。

暂时调到外存等待的进程状态为**挂起状态**。被挂起的进程PCB会被组织成**挂起队列**。

**中级调度（内存调度）**：按照某种策略决定将哪个处于挂起状态的进程重新调入内存。一个进程可能会被多次调出、调入内存，因此**中级调度发生的频率要比高级调度更高**。

## 进程的挂起态与七状态模型

暂时调到外存等待的进程状态为**挂起状态（挂起态，suspend）**，挂起态又可以进一步细分为**就绪挂起**、**阻塞挂起**两种状态。

加入挂起态后，进程的五状态模型可以扩展到七状态模型：

<img src='\images\posts\操作系统-进程-七状态模型.jpg'
  style="
    display: block;
    margin-left: auto;
    margin-right: auto; 
    zoom:50%;" />

注意“挂起”和“阻塞”的区别，两种状态都是暂时不能获得CPU的服务，但挂起态是将进程映像调到外存去了，而阻塞态下进程映像还在内存中。

有的操作系统会把就绪挂起、阻塞挂起分为两个挂起队列，甚至会根据阻塞原因不同再把阻塞挂起进程进一步细分为多个队列。

## 三层调度的联系和对比

| |行为|调度位置|频率|对进程状态的影响|
|---|---|---|---|---|
|高级调度（作业调度）|按照某种规则，从后备队列中选择合适的作业将其调入内存，并为其创建进程|外存→内存（面向作业）|最低|无→创建态→就绪态|
|中级调度（内存调度）|按照某种规则，从挂起队列中选择合适的进程将其数据调回内存|外存→内存（面向进程）|中等|挂起态→就绪态（阻塞挂起→阻塞态）|
|低级调度（进程调度）|按照某种规则，从就绪队列中选择一个进程为其分配处理机|内存→CPU|最高|就绪态→运行态|
